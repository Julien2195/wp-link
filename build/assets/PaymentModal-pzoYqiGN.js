import{j as e}from"./mui-RVdzVS6v.js";import{R as n}from"./react-BeQ55maS.js";import{l as E,E as k,a as _,b as N,u as R,c as w,C as b}from"./stripe-D3dkS7W0.js";import{u as v}from"./i18n-QcaxvB6C.js";const S="pk_live_51RhWRZGkAb9SHBQWmsHQtp2iRDbNzmhnqKGex0ksx1zGj29jgnQDY7ClEyFB3te6JxLqREsNAkt7QtltHPXcKkkz00xwuPldLJ",h=E(S);function P({plan:r="pro",onClose:s,onPaymentMethodCreated:d}){const{t}=v(),o=R(),c=w(),[l,a]=n.useState(!1),[m,p]=n.useState(null),[u,y]=n.useState(null),j=async g=>{if(g.preventDefault(),p(null),y(null),!o||!c)return;const x=c.getElement(b);if(x){a(!0);try{const{error:i,paymentMethod:f}=await o.createPaymentMethod({type:"card",card:x,billing_details:{}});i?p(i.message||t("payment.error")):(y(f),d==null||d(f))}catch(i){p((i==null?void 0:i.message)||t("errors.general"))}finally{a(!1)}}};return e.jsxs("form",{onSubmit:j,className:"payment-form",style:{display:"grid",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:t("payment.modal.chosenPlan")}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"badge",children:r==="pro"?t("payment.proTitle"):r}),e.jsx("span",{style:{opacity:.8},children:t(r==="pro"?"payment.proPrice":"payment.freePrice")})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6},children:t("payment.modal.cardInfo")}),e.jsx("div",{style:{padding:12,border:"1px solid var(--color-border)",borderRadius:8,background:"var(--color-bg)"},children:e.jsx(b,{options:{hidePostalCode:!0}})}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"color-mix(in srgb, var(--color-text) 70%, transparent)"},children:t("payment.modal.testCardHint")})]}),m&&e.jsx("div",{style:{color:"var(--color-danger)"},children:m}),u&&e.jsx("div",{className:"badge",style:{color:"var(--color-success)"},children:t("payment.modal.cardValidated",{id:u.id})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{type:"button",className:"btn",onClick:s,disabled:l,children:t("common.cancel")}),e.jsx("button",{type:"submit",className:"btn primary",disabled:!o||l,children:t(l?"payment.modal.validating":"payment.modal.validateCard")})]})]})}function z({open:r,onClose:s,plan:d="pro",checkoutClientSecret:t,onPaymentMethodCreated:o}){const c=n.useRef(null),{t:l}=v();return n.useEffect(()=>{if(!r)return;const a=m=>{m.key==="Escape"&&(s==null||s())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[r,s]),n.useEffect(()=>{if(!r)return;const a=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=a}},[r]),r?e.jsx("div",{ref:c,className:"modal-backdrop","aria-modal":"true",role:"dialog","aria-label":l("payment.modal.title"),onMouseDown:a=>{a.target===c.current&&(s==null||s())},style:{overflowY:"auto"},children:e.jsxs("div",{className:"modal payment-modal",style:{width:"min(560px, 96vw)"},children:[e.jsx("button",{className:"modal__close",onClick:s,"aria-label":l("common.close"),children:"âœ•"}),e.jsxs("div",{className:"modal__header",children:[e.jsx("h3",{className:"modal__title",children:l("payment.modal.title")}),e.jsx("p",{className:"modal__subtitle",children:l("payment.modal.subtitle")})]}),e.jsx("div",{className:"modal__body",children:t?e.jsx(k,{stripe:h,options:{clientSecret:t},children:e.jsx("div",{style:{minHeight:600},children:e.jsx(_,{})})}):e.jsx(N,{stripe:h,children:e.jsx(P,{plan:d,onClose:s,onPaymentMethodCreated:o})})})]})}):null}export{z as default};

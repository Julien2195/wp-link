import{j as e}from"./mui-RVdzVS6v.js";import{r as n}from"./react-BeQ55maS.js";import{u as g,l as k,c as v,g as N}from"./main-zk8lyFQS.js";import w from"./ReportPreview-BDuBnspC.js";import{u as S}from"./i18n-QcaxvB6C.js";import"./stripe-D3dkS7W0.js";function I({onUpgrade:j}){const{t}=S(),[i,p]=n.useState([]),[m,o]=n.useState(!0),[a,c]=n.useState(null),{canAccessFeature:d,isFree:h,isPro:u,subscription:C}=g(),l=!h||d("scan_history");n.useEffect(()=>{x()},[]);const x=async()=>{try{o(!0);const s=await k({perPage:50});p(s.items||[])}catch(s){console.error("Erreur lors du chargement des scans:",s)}finally{o(!1)}},y=async()=>{if(u&&confirm(t("history.confirmClear")))try{await v(),await x()}catch(s){console.error("Erreur lors du nettoyage de l'historique:",s),alert(t("errors.clearHistory"))}},b=async s=>{try{const r=await N(s.id,{perPage:1e3});c({scanId:s.id,stats:{total:s.total,ok:s.ok,broken:s.broken,redirect:s.redirect,internal:0,external:0},items:r.items||[]})}catch(r){console.error("Erreur lors du chargement des rÃ©sultats:",r)}},f=s=>{const r=t("locale")||"fr-FR";return new Date(s).toLocaleString(r)};return m?e.jsx("div",{className:"panel",children:e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{children:t("history.title")}),e.jsx("p",{children:t("common.loading")})]})}):e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{children:[e.jsx("h3",{children:t("history.title")}),e.jsx("p",{children:t("history.description")})]}),u&&l&&i.length>0&&e.jsx("button",{className:"btn danger",onClick:y,children:t("history.clearHistory")})]}),e.jsxs("div",{className:"panel-body",children:[h&&!d("scan_history")&&e.jsxs("div",{className:"feature-locked",children:[e.jsx("div",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("h4",{children:t("subscription.proFeature")}),e.jsx("p",{children:t("history.proFeatureDescription")}),e.jsx("button",{className:"btn primary",onClick:j,children:t("subscription.upgradeToPro")})]}),l&&i.length===0&&e.jsx("p",{children:t("history.noScans")}),l&&i.length>0&&e.jsx("div",{className:"table-wrap",children:e.jsxs("table",{className:"results-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("history.table.date")}),e.jsx("th",{children:t("history.table.status")}),e.jsx("th",{children:t("history.table.totalLinks")}),e.jsx("th",{children:t("results.status.ok")}),e.jsx("th",{children:t("history.table.redirects")}),e.jsx("th",{children:t("results.status.broken")}),e.jsx("th",{children:t("history.table.actions")})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:f(s.startedAt||s.createdAt)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})}),e.jsx("td",{children:s.total}),e.jsx("td",{children:s.ok}),e.jsx("td",{children:s.redirect}),e.jsx("td",{children:s.broken}),e.jsx("td",{children:e.jsx("button",{className:"btn",onClick:()=>b(s),disabled:s.status==="running"||s.status==="pending",children:t("history.viewReport")})})]},s.id))})]})})]}),a&&e.jsx(w,{stats:a.stats,items:a.items,scanId:a.scanId,onClose:()=>c(null)})]})}export{I as default};

import{j as e}from"./mui-RVdzVS6v.js";import{r as i}from"./react-BeQ55maS.js";import{u as k,a as E,r as T,b as P,d as R,e as I,U as O,f as $,h as A}from"./main-zk8lyFQS.js";import H from"./UpgradeModal-T3dxpy-3.js";import z from"./PaymentModal-pzoYqiGN.js";import{u as N}from"./i18n-QcaxvB6C.js";import"./stripe-D3dkS7W0.js";function D(){const{t}=N(),{subscription:m,refresh:n}=k(),[l,a]=i.useState(!1),[y,c]=i.useState(!1),g=(m==null?void 0:m.isCancelling)||!1,d=async()=>{a(!0);try{await E(),await n(),c(!1),alert(t("subscription.cancel.scheduledAlert"))}catch(u){console.error("Cancel error:",u),alert(t("subscription.cancel.error"))}finally{a(!1)}},f=async()=>{a(!0);try{await T(),await n(),alert(t("subscription.resume.success"))}catch(u){console.error("Resume error:",u),alert(t("subscription.resume.error"))}finally{a(!1)}};return g?e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("div",{style:{padding:"12px",backgroundColor:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid var(--color-warning)",borderRadius:"var(--radius, 8px)",marginBottom:"12px"},children:e.jsx("p",{style:{margin:0,fontSize:"14px",color:"var(--color-text)"},children:t("subscription.cancel.scheduledInfo")})}),e.jsx("button",{className:"btn primary outline",onClick:f,disabled:l,children:t(l?"subscription.resume.processing":"subscription.resume.button")})]}):y?e.jsxs("div",{style:{marginTop:"16px",padding:"16px",border:"1px solid var(--color-danger)",borderRadius:"var(--radius, 8px)",backgroundColor:"color-mix(in srgb, var(--color-danger) 8%, transparent)"},children:[e.jsx("h4",{style:{margin:"0 0 8px 0",color:"var(--color-danger)"},children:t("subscription.cancel.confirmTitle")}),e.jsx("p",{style:{margin:"0 0 16px 0",color:"var(--color-text)",fontSize:"14px",lineHeight:"1.4"},children:t("subscription.cancel.confirmMessage")}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{className:"btn danger",onClick:d,disabled:l,children:t(l?"subscription.cancel.processing":"subscription.cancel.confirmYes")}),e.jsx("button",{className:"btn",onClick:()=>c(!1),disabled:l,children:t("subscription.cancel.confirmNo")})]})]}):e.jsx("button",{className:"btn danger outline",onClick:()=>c(!0),style:{marginTop:"16px"},children:t("subscription.cancel.button")})}function G({theme:t,onChangeTheme:m}){const{t:n,i18n:l}=N(),{isPro:a,isFree:y,subscription:c}=k(),[g,d]=i.useState(!1),[f,u]=i.useState(!1),[_,w]=i.useState(null),[C,h]=i.useState(!1),[B,U]=i.useState(!0),[S,j]=i.useState(!1);return i.useEffect(()=>{let o=!0;return(async()=>{try{const{connected:r}=await P();o&&h(!!r)}catch{o&&h(!1)}finally{o&&U(!1)}})(),()=>{o=!1}},[]),e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{children:n("settings.title")}),e.jsx("p",{children:n("settings.description")})]}),e.jsxs("div",{className:"panel-body",children:[!B&&e.jsxs("div",{id:"lf-consent",style:{marginBottom:16,padding:12,backgroundColor:"var(--color-bg-secondary)",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:n("connection.statusTitle")}),e.jsx("div",{style:{opacity:.85},children:n(C?"connection.connected":"connection.notConnected")})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[!C&&e.jsx("button",{className:"btn primary",disabled:S,onClick:async()=>{j(!0);try{await R(),h(!0)}catch{alert(n("connection.error"))}finally{j(!1)}},children:n(S?"common.loading":"connection.connectButton")}),C&&e.jsx("button",{className:"btn danger",onClick:async()=>{if(confirm(n("connection.disconnectConfirm")))try{await I(),h(!1);const o=typeof window<"u"?window:null;if(o&&o.location){const{location:r}=o,p=r.origin,x=r.pathname,b=x.indexOf("/wp-admin/"),s=`${b>=0?p+x.slice(0,b+10):p+"/wp-admin/"}admin.php?page=link-fixer#lf-consent`;o.location.assign(s);return}alert(n("connection.disconnectSuccess"))}catch{alert(n("connection.disconnectError"))}},children:n("connection.disconnectButton")})]})]}),y&&e.jsx("div",{className:"unlock-cta",style:{marginBottom:16},children:e.jsx(O,{onClick:()=>d(!0)})}),c&&e.jsxs("div",{style:{marginBottom:24,padding:16,backgroundColor:"var(--color-bg-secondary)",borderRadius:8},children:[e.jsx("h4",{style:{margin:"0 0 8px 0"},children:n("settings.subscription.current")}),e.jsxs("p",{style:{margin:"0 0 8px 0"},children:[n("settings.subscription.plan")," :"," ",e.jsx("strong",{children:n(a?"subscription.proPlan":"subscription.freePlan")}),c.isCancelling&&e.jsxs("span",{style:{marginLeft:"8px",fontSize:"12px",color:"var(--color-warning)",fontWeight:"normal"},children:["(",n("settings.subscription.cancellationScheduled"),")"]})]}),c.renewsAt&&e.jsxs("p",{style:{margin:"0",fontSize:"14px",color:"var(--color-text-secondary)"},children:[c.isCancelling?n("subscription.expiresOn"):n(a?"settings.subscription.renewal":"subscription.expiresOn")," ",":"," ",new Date(c.renewsAt).toLocaleDateString(l.language==="fr"?"fr-FR":"en-US")]}),a&&e.jsx(D,{})]})]}),g&&e.jsx(H,{open:g,onClose:()=>d(!1),onProceedPayment:async o=>{const r=typeof window<"u"&&window.location?window.location.href.split("#")[0]:"",p=r.includes("?")?"&":"?",x=r?`${r}${p}checkout_return=1&session_id={CHECKOUT_SESSION_ID}`:void 0,b=r?`${r}${p}checkout_success=1&session_id={CHECKOUT_SESSION_ID}`:void 0,v=r?`${r}${p}checkout_cancel=1`:void 0;try{const{clientSecret:s}=await $({plan:o||"pro",returnUrl:x});if(s){w(s),d(!1),u(!0);return}}catch(s){console.error("Embedded Checkout indisponible:",(s==null?void 0:s.message)||s,s)}try{const{url:s}=await A({plan:o||"pro",successUrl:b,cancelUrl:v});if(s){d(!1),window.location.assign(s);return}}catch(s){console.error("Hosted Checkout indisponible:",(s==null?void 0:s.message)||s,s)}alert(n("payment.errorStart"))}}),f&&e.jsx(z,{open:f,onClose:()=>{u(!1),w(null)},checkoutClientSecret:_})]})}export{G as default};
